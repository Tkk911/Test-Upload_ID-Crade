<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="utf-8"/>
<title>ทดสอบอัปโหลดบัตรสอบ</title>
<style>
    body { font-family: sans-serif; max-width: 500px; margin: 50px auto; }
    label { display: block; margin-top: 10px; }
    input, button { width: 100%; padding: 8px; margin-top: 5px; }
    .result { margin-top: 15px; padding: 10px; border-radius: 6px; }
    .ok { background: #e6ffed; border: 1px solid #a3e6b3; }
    .err { background: #ffecec; border: 1px solid #f2a2a2; }
  </style>
</head>
<body>
<h2>อัปโหลดบัตรสอบไป Google Drive</h2>
<label>ชื่อผู้สอบ</label>
<input id="studentName" placeholder="กรอกชื่อ" type="text"/>
<label>เลือกบัตรสอบ (รูปหรือ PDF)</label>
<input accept="image/*,.pdf" id="fileInput" type="file"/>
<button id="btnUpload">อัปโหลด</button>
<div id="status"></div>
<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxHQKcaDP6U6WXs5Wo3vEM9opTADduvLjyM1PtnStDqfWxukAr76unY7q70jq4B3h5u/exec";

    const btn = document.getElementById("btnUpload");
    const statusEl = document.getElementById("status");

    function setStatus(msg, ok = true) {
      statusEl.innerHTML = `<div class="result ${ok ? "ok" : "err"}">${msg}</div>`;
    }

    btn.addEventListener("click", async () => {
      const student = document.getElementById("studentName").value.trim();
      const fileInput = document.getElementById("fileInput");
      if (!student) { setStatus("⚠️ กรุณากรอกชื่อผู้สอบ", false); return; }
      if (!fileInput.files[0]) { setStatus("⚠️ กรุณาเลือกไฟล์", false); return; }

      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = async function(e) {
        const base64Data = e.target.result.split(",")[1];

        setStatus("⏳ กำลังอัปโหลด...");

        try {
          const res = await fetch(GAS_URL, {
            method: "POST",
            body: JSON.stringify({
              student: student,
              fileName: file.name,
              mimeType: file.type,
              data: base64Data
            }),
            headers: { "Content-Type": "application/json" }
          });
          const data = await res.json();
          if (data.status === "success") {
            setStatus(`✅ อัปโหลดสำเร็จ <br><a href="${data.fileUrl}" target="_blank">เปิดไฟล์ใน Drive</a>`);
          } else {
            setStatus("❌ อัปโหลดไม่สำเร็จ: " + data.message, false);
          }
        } catch (err) {
          setStatus("❌ เกิดข้อผิดพลาด: " + err.message, false);
        }
      };
      reader.readAsDataURL(file);
    });
</script>
</body>
</html>



